{"version":3,"sources":["bin/server.js"],"names":[],"mappings":";;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAIA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AATA;;AAXA;AAsBA,IAAM,MAAM,mBAAZ;;AAEA;;AAEA,IAAI,GAAJ,CAAQ,8BAAR;;AAEA;;AAEA,IAAI,GAAJ,CAAQ,yBAAM,eAAK,IAAL,CAAU,SAAV,EAAoB,WAApB,CAAN,CAAR;;AAEA;;AAEA;;AAEA;;AAEA,IAAI,GAAJ,CAAQ,+BAAgB;AACpB,UAAM,kBAAI,IADU;AAEpB,WAAO;AAFa,CAAhB,CAAR;AAIA,IAAI,GAAJ,CAAQ,0BAAgB,gBAAhB,EAAR;AACA,IAAI,GAAJ,CAAQ,0BAAgB,aAAhB,CAA8B;AAClC,4BAAwB,gCAAU,MAAV,EAAkB,GAAlB,EAAuB;AAC3C,eAAO,IAAP,GAAc,KAAK,OAAL,CAAa,IAA3B;AACH,KAHiC;AAIlC,6BAAyB,iCAAU,MAAV,EAAkB,GAAlB,EAAuB;AAC5C,eAAO,IAAP,GAAc,KAAK,QAAL,CAAc,IAA5B;AACH;AANiC,CAA9B,CAAR;;AASA;;AAEA,mBAAS,OAAT,GAAmB,OAAO,OAA1B;AACA,mBAAS,OAAT,CAAiB,iBAAO,OAAxB;;AAEA;;AAEA,QAAQ,oBAAR;AACA,IAAI,GAAJ,CAAQ,sBAAS,UAAT,EAAR;;AAEA;;AAEA,IAAI,GAAJ,CAAQ,uBAAK,EAAC,aAAa,IAAd,EAAL,CAAR;;AAEA;;AAEA,IACK,GADL,CACS,eAAK,MAAL,CAAY,MAAZ,EADT,EAEK,GAFL,CAES,eAAK,MAAL,CAAY,cAAZ,EAFT,EAGK,GAHL,CAGS,eAAK,MAAL,CAAY,MAAZ,EAHT,EAIK,GAJL,CAIS,eAAK,MAAL,CAAY,cAAZ,EAJT,EAKK,GALL,CAKS,gBAAM,MAAN,CAAa,MAAb,EALT,EAMK,GANL,CAMS,gBAAM,MAAN,CAAa,cAAb,EANT,EAOK,GAPL,CAOS,kBAAQ,MAAR,CAAe,MAAf,EAPT,EAQK,GARL,CAQS,kBAAQ,MAAR,CAAe,cAAf,EART,EASK,GATL,CASS,gBAAM,MAAN,CAAa,MAAb,EATT,EAUK,GAVL,CAUS,gBAAM,MAAN,CAAa,cAAb,EAVT,EAWK,GAXL,CAWS,qBAAW,MAAX,CAAkB,MAAlB,EAXT,EAYK,GAZL,CAYS,qBAAW,MAAX,CAAkB,cAAlB,EAZT,EAaK,GAbL,CAaS,eAAK,MAAL,CAAY,MAAZ,EAbT,EAcK,GAdL,CAcS,eAAK,MAAL,CAAY,cAAZ,EAdT;;AAgBA;;AAEA,IAAI,MAAJ,CAAW,iBAAO,IAAlB","file":"bin/server.js","sourcesContent":["\nimport koa from 'koa';\n// import logger from 'koa-logger';\nimport bodyParser from 'koa-bodyparser';\nimport mongoose from 'mongoose';\nimport passport from 'koa-passport';\nimport koaBunyanLogger from 'koa-bunyan-logger';\nimport serve from 'koa-static';\nimport path from 'path';\nimport cors from 'koa-cors';\n\nimport config from '../config';\n\n// route\n\nimport home from '../routes/home';\nimport user from '../routes/user';\nimport token from '../routes/token';\nimport project from '../routes/project';\nimport patch from '../routes/patch';\nimport permission from '../routes/permission';\nimport file from '../routes/file';\nimport pkg from '../../package.json';\n\nconst app = new koa();\n\n// bodyParser\n\napp.use(bodyParser());\n\n// static\n\napp.use(serve(path.join(__dirname,'../assets')));\n\n// logger\n\n// app.use(logger());\n\n// koa-bunyan-logger\n\napp.use(koaBunyanLogger({\n    name: pkg.name,\n    level: 'debug'\n}));\napp.use(koaBunyanLogger.requestIdContext());\napp.use(koaBunyanLogger.requestLogger({\n    updateRequestLogFields: function (fields, err) {\n        fields.body = this.request.body;\n    },\n    updateResponseLogFields: function (fields, err) {\n        fields.body = this.response.body;\n    }\n}));\n\n// mongodb\n\nmongoose.Promise = global.Promise;\nmongoose.connect(config.mongodb);\n\n// passport\n\nrequire('../config/passport');\napp.use(passport.initialize());\n\n// cors\n\napp.use(cors({credentials: true}));\n\n// router\n\napp\n    .use(home.router.routes())\n    .use(home.router.allowedMethods())\n    .use(user.router.routes())\n    .use(user.router.allowedMethods())\n    .use(token.router.routes())\n    .use(token.router.allowedMethods())\n    .use(project.router.routes())\n    .use(project.router.allowedMethods())\n    .use(patch.router.routes())\n    .use(patch.router.allowedMethods())\n    .use(permission.router.routes())\n    .use(permission.router.allowedMethods())\n    .use(file.router.routes())\n    .use(file.router.allowedMethods());\n\n// listen\n\napp.listen(config.port);\n"],"sourceRoot":"/source/"}